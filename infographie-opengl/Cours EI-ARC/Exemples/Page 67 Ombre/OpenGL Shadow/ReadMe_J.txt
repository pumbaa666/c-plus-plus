
■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■


			IShadowMap-1.2
		http://www.daionet.gr.jp/~masa/ishadowmap

		２０００年９月
		Masa（川瀬 正樹）
		E-Mail: masa@daionet.gr.jp
		URL   : http://www.daionet.gr.jp/~masa


■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■



	■■■■　目次　■■■■

■　IShadowMap について
■　動作環境
■　インストール
■　技術的なこと
■　トラブルシューティング
■　免責事項等
■　更新履歴


	■■■■　IShadowMap について　■■■■

OpenGL で作成した シャドウマッピング（Shadow Mapping） のデモです。
が、それだけでは面白味に欠けるため、

■　大気効果（Atmospheric Effect）というかボリュームライト？
■　床への映りこみ（Reflection）
■　フレネル効果（Fresnel Effect）
■　光沢マッピング（Gloss Mapping）

などのエフェクトを行っています。


	■■■■　動作環境　■■■■

■　Intel 80x86 系 CPU を搭載した DOS/V AT 互換機
■　Microsoft Windows 95/98/NT4/2000
■　OpenGL-1.1 以降に対応し、かつ
　　・GL_ARB_multitexture
　　・GL_EXT_multitexture
　　・GL_SGIS_multitexture
　　のいずれかの拡張機能をサポート

が基本的な動作条件です。
が、これだけでは肝心のシャドウマッピングとグロスマッピングが有効になりません。
これらのエフェクトの実行には、実行時の OpenGL が

■　４ビット以上のαプレーン
■　GL_EXT_texture_env_combine

をサポートしている必要があります。
環境によって微妙に変化するような機能も使っているため、これらをすべて実装している
環境でも動くとは限りません。

正しい動作と充分な速度が出ることを確認した環境は
nVIDIA GeForce 256 の reference driver 5.x 以降だけです。
GeForce2 GTS もおそらく大丈夫でしょう。
nVIDIA Riva TNT シリーズでは点光源の投影にバグが出るため、デフォルトで平行光源で
起動します。

Riva TNT シリーズで実行する場合、nVIDIA reference driver 6.x 以降、
GeForce シリーズで実行する場合は nVIDIA reference driver 5.x 以降のドライバを
使わないと極端に遅くなります。


	■■■■　インストール　■■■■

アーカイブを適当な場所に展開し、ishadowmap.exe を実行するだけです。
実行中 'h' キーでコントロールのヘルプが出ます。
適当に操作して遊んでみてください。

大抵の環境では 32 bits モードでないとαプレーンをサポートしません。
シャドウマッピングおよびグロスマッピングを有効にするために、
できるだけ 32 bits カラーモードで実行することをお勧めします。


	■■■■　技術的なこと　■■■■

通常、シャドウマップは光源からの距離をレンダリングし、テクスチャのα値として
保存しておきます。
実際の描画時にフラグメントの光源からの距離を計算し、これを、プロジェクション
マッピングしたシャドウマップのα値と比較することで影か否かを判定します。

が、このサンプルでは距離情報は一切使わず、 代わりに凸面体単位で固有のＩＤを
シャドウマップのαチャネルにレンダリングしています。
実際の描画時には同じＩＤをα値として与え、 それがプロジェクションマッピング
したシャドウマップの α値と一致したピクセルのみが光源から直接光を受けていると
みなし、 ライティングを行います。
これにより、

■　深度の精度不足（αチャネルのビット深度に依存）
■　距離比較のためだけにテクスチャが２枚必要

といったシャドウマッピングの弱点を解消できます。
逆にデメリットとして、

■　凸面体をαチャネルの精度で表現できる数しか描画できない
■　凹面体は凸面毎に別のα値を与える必要があるため面倒
■　凹面体はシャドウテクスチャのサイズをかなり大きくしないと継ぎ目が目立つ
■　半透明オブジェクトをシーンに混在しにくい

といった点が挙げられます。
ついでにα値の一致判定はおそらく環境依存します。
とりあえずは GeForce に最適化しましたが、 他の環境ではおかしな結果になる可能性が
高いと思われます（ぅ 


	■■■■　トラブルシューティング　■■■■

描画がおかしくなってうまく影が表示されない場合は、 'a' / 'A' キーでα値の
参照バイアスを増加／減少させたり、't' キーでシャドウマッピング時のテクスチャ
フィルタを切り替えてみてください。 
改善される可能性があります。


	■■■■　免責事項等　■■■■

本ソフトウェアの著作権は Masa こと 川瀬 正樹 が保持します。
二次配布等に関しては自由に行って頂いて構いません。

このソフトウェアによって発生したいかなる損害に対しても、著作者は一切の責を
負いかねます。
予めご了承の上でお楽しみください。


	■■■■　更新履歴　■■■■

■　2000.09.09	IShadowMap-1.2

		・異方性フィルタ（Anisotropic Filtering）のサポート
		　　GL_EXT_texture_filter_anisotropic をサポートしている環境では
		　　デフォルト異方性２で自動的に有効になります。
		　　サポートしていない環境では無効（異方性１）です。
		　　特に床を斜めから眺めた場合に、テクスチャがより鮮明になります。
		　　実行中 'u'/'U' キーで、異方性を可能な範囲（１からサポート
		　　されている最大値まで）で増減できます。

■　2000.09.04	IShadowMap-1.1

		・nVIDIA Riva TNT シリーズではデフォルトで平行光源にして対応
		・一部のテクスチャ変更等のマイナーチェンジ

■　2000.08.30	IShadowMap-1.0 初公開
